import{s as a,a as c,b as h,g as u,c as l,i as g}from"./theme-scripts-1743080927.js";class S extends HTMLElement{constructor(){super(),this.sessionKeys=a,this.currentStoreUrl=window.currentShop.url}connectedCallback(){this.initializeElements(),this.init(),this.initializeState(),this.setupEventListeners()}initializeElements(){this.redirectBtn=this.querySelector("[data-redirect-button]"),this.stayBtn=this.querySelector("[data-stay-button]")}initializeState(){this.hasBeenAskedOrRedirectedAlready=this.getSessionItem(this.sessionKeys.hasBeenAsked),this.isPreferredStore=c(this.currentUserCountryCode,this.currentStoreUrl)}setupEventListeners(){this.redirectBtn?.addEventListener("click",()=>this.handleRedirect()),this.stayBtn?.addEventListener("click",()=>this.dismissModal())}async init(){this.isTestMode=this.hasAttribute("data-testmode"),this.isStagingMode=this.currentStoreUrl.includes("myshopify.com"),this.isDesignMode=Shopify.designMode,await this.initializeLocationData();const e=h({currentStoreUrl:this.currentStoreUrl,currentUserCountryCode:this.currentUserCountryCode,currentStoreCountryCode:this.currentStoreCountryCode,isTestMode:this.isTestMode,isStagingMode:this.isStagingMode});console.log(e),this.isTestMode&&this.handleStorePreference(e),!(this.hasBeenAskedOrRedirectedAlready||this.isPreferredStore)&&this.handleStorePreference(e)}async initializeLocationData(){this.currentUserCountryCode=await u(),this.currentStoreCountryCode=l(this.currentStoreUrl)}handleStorePreference(e){const t=window.storeSelectorConfig.regions[this.currentStoreCountryCode];this.isUserInCurrentRegion(t)?sessionStorage.setItem(this.sessionKeys.isPreferred,"true"):sessionStorage.removeItem(this.sessionKeys.isPreferred),this.handleUserRedirect(e)}isUserInCurrentRegion(e){return e&&g(this.currentUserCountryCode,this.currentStoreCountryCode)&&e.suggestedStoreUrl===this.currentStoreUrl}handleUserRedirect(e){!e?.showRedirectPopup&&e?.popoverDisabled||(this.replaceModalContent(e),this.showPopover())}replaceModalContent(e){const t={heading:this.querySelector("[data-heading]"),body:this.querySelector("[data-body]"),redirectBtn:this.querySelector("[data-redirect-button]"),stayBtn:this.querySelector("[data-stay-button]")};for(const[C,r]of Object.entries(t)){if(!r)continue;let s=r.innerHTML;const i=window.storeSelectorConfig.regions[this.currentStoreCountryCode],o=window.storeSelectorConfig.regions[e.suggestedStoreCountryCode],n=i?.displayName||this.currentStoreCountryCode||"Current Store",d=e.isStoreLocator?"Store Locator":e.suggestedStoreRegion||o?.displayName||e.suggestedStoreCountryCode;s=s.replace(/\{current_store\}/g,n).replace(/\{suggested_store\}/g,d),r.innerHTML=s}t.redirectBtn&&(t.redirectBtn.href=e.suggestedStoreUrl||window.currentShop.storeLocatorUrl)}dismissModal(){sessionStorage.setItem(this.sessionKeys.hasBeenAsked,"true"),this.hidePopover()}handleRedirect(){sessionStorage.setItem(this.sessionKeys.hasBeenAsked,"true")}getSessionItem(e){return sessionStorage.getItem(e)==="true"}showPopover(){this.hasAttribute("popover")&&this.togglePopover(!0)}hidePopover(){this.hasAttribute("popover")&&this.togglePopover(!1)}}customElements.define("store-selector-popover",S);
//# sourceMappingURL=/cdn/shop/t/28/assets/novicell_store-selector-17430809272.js.map
