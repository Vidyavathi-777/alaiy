class p extends HTMLElement{constructor(){super(),this.addEventListener("click",e=>{e.preventDefault(),(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0)})}}customElements.define("cart-remove-button",p);class g extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const e=debounce(t=>{this.onChange(t)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",e.bind(this))}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,e=>{e.source!=="cart-items"&&this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}onChange(e){this.updateQuantity(e.target.dataset.index,e.target.value,document.activeElement.getAttribute("name"))}onCartUpdate(){fetch("/cart?section_id=novicell_main-cart-items").then(e=>e.text()).then(e=>{const a=new DOMParser().parseFromString(e,"text/html").querySelector("cart-items");this.innerHTML=a.innerHTML}).catch(e=>{console.error(e)})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(e,t,a){this.enableLoading(e);const n=JSON.stringify({line:e,quantity:t,sections:this.getSectionsToRender().map(r=>r.section),sections_url:window.location.pathname});fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:n}).then(r=>r.text()).then(r=>{const s=JSON.parse(r),m=document.getElementById(`Quantity-${e}`)||document.getElementById(`Drawer-quantity-${e}`),y=document.querySelectorAll(".cart-item");if(s.errors){m.value=m.getAttribute("value"),this.updateLiveRegions(e,s.errors);return}this.classList.toggle("is-empty",s.item_count===0);const c=document.querySelector("cart-drawer"),h=document.getElementById("main-cart-footer");h&&h.classList.toggle("is-empty",s.item_count===0),c&&c.classList.toggle("is-empty",s.item_count===0),this.getSectionsToRender().forEach(o=>{const E=document.getElementById(o.id).querySelector(o.selector)||document.getElementById(o.id);E.innerHTML=this.getSectionInnerHTML(s.sections[o.section],o.selector)});const l=s.items[e-1]?s.items[e-1].quantity:void 0;let u="";y.length===s.items.length&&l!==parseInt(m.value)&&(typeof l>"u"?u=window.cartStrings.error:u=window.cartStrings.quantityError.replace("[quantity]",l)),this.updateLiveRegions(e,u);const d=document.getElementById(`CartItem-${e}`)||document.getElementById(`CartDrawer-Item-${e}`);d&&d.querySelector(`[name="${a}"]`)?c?trapFocus(c,d.querySelector(`[name="${a}"]`)):d.querySelector(`[name="${a}"]`).focus():s.item_count===0&&c?trapFocus(c.querySelector(".drawer__inner-empty"),c.querySelector("a")):document.querySelector(".cart-item")&&c&&trapFocus(c,document.querySelector(".cart-item__name")),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items"})}).catch(()=>{this.querySelectorAll(".loading-overlay").forEach(s=>s.classList.add("hidden"));const r=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");r.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(e)})}updateLiveRegions(e,t){const a=document.getElementById(`Line-item-error-${e}`)||document.getElementById(`CartDrawer-LineItemError-${e}`);a&&(a.querySelector(".cart-item__error-text").innerHTML=t),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const n=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");n.setAttribute("aria-hidden",!1),setTimeout(()=>{n.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(e,t){return new DOMParser().parseFromString(e,"text/html").querySelector(t).innerHTML}enableLoading(e){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const a=this.querySelectorAll(`#CartItem-${e} .loading-overlay`),n=this.querySelectorAll(`#CartDrawer-Item-${e} .loading-overlay`);[...a,...n].forEach(r=>r.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(e){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const a=this.querySelectorAll(`#CartItem-${e} .loading-overlay`),n=this.querySelectorAll(`#CartDrawer-Item-${e} .loading-overlay`);a.forEach(r=>r.classList.add("hidden")),n.forEach(r=>r.classList.add("hidden"))}}customElements.define("cart-items",g),customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("change",debounce(e=>{const t=JSON.stringify({note:e.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:t})},ON_CHANGE_DEBOUNCE_TIMER))}}),customElements.get("cart-accept-terms")||customElements.define("cart-accept-terms",class extends HTMLElement{constructor(){super(),this.wrapper=this,this.checkoutButton=this.parentElement.querySelector('button[name="checkout"]')||this.parentElement.querySelector('button[type="submit"]'),this.checkbox=this.querySelector('[name="acceptTerms"]'),this.checkbox.checked=localStorage.getItem("terms-accepted")==="true";const e=this.checkbox.closest(".drawer__footer, .cart__footer").querySelector("modal-opener[data-future-modal]");localStorage.getItem("terms-accepted")!==null&&localStorage.getItem("terms-accepted")!=="true"&&this.wrapper.classList.add("error"),e&&this.checkbox.checked&&e.setAttribute("data-modal",e.getAttribute("data-future-modal")),this.checkoutButton&&this.checkoutButton.addEventListener("click",t=>{this.checkbox.checked||(t.preventDefault(),this.wrapper.classList.add("error"))}),this.checkbox.addEventListener("change",()=>{this.checkbox.checked?(localStorage.setItem("terms-accepted",!0),e.setAttribute("data-modal",e.getAttribute("data-future-modal")),this.wrapper.classList.remove("error")):(localStorage.setItem("terms-accepted",!1),this.wrapper.classList.add("error"),e.removeAttribute("data-modal"))})}});class b extends g{getSectionsToRender(){return[{id:"CartDrawer",section:"novicell_cart-drawer",selector:".drawer__inner"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:"#cart-icon-bubble"}]}}customElements.define("cart-drawer-items",b);
//# sourceMappingURL=/cdn/shop/t/28/assets/novicell_cart-17430809272.js.map
